<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lawyers-Legal Reach</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="../uploads/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.css">   
     <link rel="stylesheet" href="lawyerprofile1.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Roboto+Slab&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  .stars{
    display: inline-block;
  }

  

</style>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <%-include('partials/header') %>

   <div class="body"> 
    <div class="main-body">
   
        <% lawyers.forEach(lawyer => { %>
     <div class="lawyer-profile-container-0">
        <div class="lawyer-profile-container">
            <div class="lawyer-profile">
               <div class="lawyer-img-info">
                <div class="lawyer-image">
                       <div class="img-box">
                        <img src="https://<%=lawyer.image%>" alt="">
                       </div>
                </div>
                <div class="lawyer-info">
                     <div class="lawyer-name-ratings">
                       <div class="name">
                           <h2><%= lawyer.name %></h2>
                       </div>
                       <div class="rating">
                             <div class="rating-star">
                              <% for (let i=1; i<=5; i++) { %>
                                 <% if(i<= Math.floor(averageRating)) { %>
                                  <span class="fa fa-star rating-checked-reveiew"></span>
                                 <% } else if(i===Math.ceil(averageRating) && !Number.isInteger(averageRating)) { %>
                                  <span class="fa fa-star-half-alt rating-checked"></span>
                                <% } else {  %>
                                  <span class="fa fa-star"></span>
                                <% } %>
                               <% } %>
                                <!-- <span class="fa fa-star rating-checked"></span>
                                <span class="fa fa-star rating-checked"></span>
                                <span class="fa fa-star rating-checked"></span>
                                <span class="fa fa-star"></span> -->
                             </div>
                             <div class="rating-info"><%=averageRating.toFixed(1)%>|
                               <%= clientCount %>+ user<%= clientCount > 1 ? 's':''%> rating
                             </div>
                       </div>
                     </div>
                     <hr>
                     <div class="lawyer-details-area">
                        <div class="lawyer-details">
                            <div class="lawyer-sub-details">
                            <div class="lawyer-loc">
                              <i class="fa-solid fa-location-dot"></i>&nbsp;&nbsp;<span><%=lawyer.city%>, <%=lawyer.state%></span>
                              </div>
                              <div class="lawyer-exp">
                                <i class="fa-solid fa-suitcase"></i>&nbsp;&nbsp;<span><%=lawyer.yrs_exp%> Years experience</span>
                              </div>
                              <div class="lawyer-language">
                                <i class="fa-solid fa-language"></i>&nbsp;&nbsp;<span><%=lawyer.language%></span>
                              </div>
                              </div>
                              <div class="lawyer-sub-button">
                              <div class="lawyer-contact">
                                <button class="contact-btn" value="contact">Contact</button>
                                <!-- <a href="https://wa.me/918779642973?text=Hello" target="_blank">Chat with us on WhatsApp</a> -->

                              </div> 
                              </div> 
                        </div>
                        <div class="lawyer-area">
                            <div class="lawyer-skill">
                                <h4>Pratice area & Skills - </h4>
                                <p><%=lawyer.area_of_prac.join(', ')%></p>
                           </div>
                        </div>
                     </div>
                </div>                
               </div> 
               <div class="form-container-0">
                <div class="form-container">
                 <a href="#" class="close">&times;</a>
                 <div class="form-headings">
                  <h2>Please enter your mail id to send you lawyer details.</h2>
                  </div>
                  <div class="wrapper">
                   <form id="email-send" action="/lawyersprofile?lawyerId=<%=lawyerId%>" method="post">
                     <div class="input-fields">
                      <input type="hidden" id="lawyerId" value="<%= lawyerId %>">
                      <div class="input-field if-field">
                        <input type="name" name="name" id="details-email" placeholder="Name" required>
                      </div>
                   <div class="input-field if-field">
                     <input type="email" name="email" id="details-email" placeholder="Email Address" required>
                   </div>
                  <div class="input-field if-field">
                     <input type="tel" name="phone" id="details-phone" placeholder="Contact Number" required>
                  </div>
                     </div>
                   
                     <div  class="submit-form">  
                   <div class="btn-container">
                     <div class="btn-layer"></div>
                   
                        <!-- <button class="submit-btn" id="details-submit-btn" type="submit"></button> -->
                        <input type="submit" value="Submit" class="submit-btn" id="details-submit-btn">
                 </div>
                
               
             
                     </div>
                  </form>
                  </div>
                </div>
               </div>
               <hr class="lawyer-hr">
               <div class="lawyer-bio">
                <div class="lawyer-para">
                 <p><%=lawyer.bio%></p>
                 
                </div>
                 <div class="courts">
                    <div class="court">Courts</div>
                    <div class="court-name">
                      <%= lawyer.courts %> 
                    </div>
                 </div>
               </div>
            </div>
            <div class="lawyer-reveiews">
      <div class="reveiew-title">
          Client Reviews
          <hr>
      </div>
    
        <% if(currentUser === null || currentUser.role==='client'){ %>
          <div class="add-reveiew">
            <div class="add-reveiew-container">
                <form id="add-review" action="/lawyersprofile/review" method="post">
                  <input type="hidden" name="lawyerId" value="<%= lawyerId %>">
                <div class="reveiew-rating">
                    <input type="number"  hidden> 
                    <div class="rate">
                    <% for(let i=5;i>=1;i--) { %>
                  
                    <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>" class="star-input">
                    <label for="star<%= i %>"><span class="far fa-star fa star"></span></label>
                    <% } %>
                    </div>
                </div>
                <div class="text-box">
                        <textarea name="comment" id="new-reveiew" cols="40" rows="5" placeholder="add a review"></textarea>
                        <div class="new-ok-cnc-btn">
                            <button type="submit" class="new-ok-btn">Submit</button> 
                        </div>
                </div>
                </form>
            </div>
        </div>
       <% }   %>
      
      
   
      
        
            </div>
            <div class="reveiew-section">
        <% reviews.forEach(review=>{ %>
          <div class="reveiew-container">
            
              <div class="reveiew-name-rating-delete">
                <div class="review-name-rating">
                <div class="reveiew-name">
                 <%= review.name %>
                </div>
                <div class="reveiew-rating">
                  <% for (let i=0;i< review.rating; i++) { %>
                    <span class="fa fa-star rating-checked-reveiew"></span>
                    <% } %>
                  <% for (let i=review.rating; i<5; i++) { %>
                    <span class="fa fa-star"></span>
                    <% } %>
                </div>
                </div>
                <div class="review-date-delete">
                <div class="review-date">
                   <%= formatDate(review.created_at) %>
                </div>
                <div class="review-delete">
                 <% if(currentUser!== null && currentUser.role==='client') { %>
                  <% if(review.client_id===currentUser.id) { %>
                    <form id="review-del" action="lawyersprofile/reviews/<%= review.id%>?_method=DELETE" method="post">
                      <input type="hidden" id="reviewId" value="<%=review.id%>">
                    <button class="delbtn" type="submit"><i class="fa-solid fa-trash-can"></i></button>
                  </form>  
                 <% } %>
                <% } %>
                 
          
                  <!-- <span class="reveiew-delete-btn" id="reveiew-delete-btn-1">&nbsp;&nbsp;Delete</span> -->
                </div>
                </div>
            </div>
            <div class="reveiew-para">
             <p><%= review.comment %></p>
            </div>
            
        </div>
       <% }) %>
          
         
            
         
             
               
              
     
        <% }); %>
     <!-- </div> -->
            </div>
         </div>
      </div>
    </div> 
    <%-include('partials/footer') %>
    </div>   
   
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>


<script>

document.addEventListener('DOMContentLoaded',()=>{
    const form = document.getElementById('email-send');
    const lawyerId = document.getElementById('lawyerId').value;
    form.addEventListener('submit',async(event)=>{
        event.preventDefault();
        Toastify({
            text: "Sending you lawyer details on your email...please wait",
            duration: 3500,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor:"#4CAF50",
        }).showToast();
        const formData = new FormData(form);
        const json = Object.fromEntries(formData.entries());
        try{
            const response = await fetch(`/lawyersprofile?lawyerId=${lawyerId}`,{
                method: 'POST',
                headers: {
                  'Content-Type':'application/json'
                },
                body: JSON.stringify(json)
            });
        const data = await response.json();
        Toastify({
            text: data.message,
            duration: 3000,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor: data.success? "#4CAF50":"FF0000",
        }).showToast();

        if(data.success){
         
            setTimeout(()=>{
                window.location.href=`/lawyersprofile?lawyerId=${lawyerId}`;
            },1000); 
        } 

        } catch(error){
            console.error('Error:', error);
            Toastify({
            text: "An error occurred. Please try again.",
            duration: 3000, 
            close: true, 
            gravity: "top", 
            position: "center", 
            backgroundColor: "#FF0000", 
          }).showToast();
        }
    })
    const form1 = document.getElementById('add-review');
    form1.addEventListener('submit',async(event)=>{
        event.preventDefault();
        const formData = new FormData(form1);
        const json = Object.fromEntries(formData.entries());
        try{
            const response = await fetch('/lawyersprofile/review',{
                method: 'POST',
                headers: {
                  'Content-Type':'application/json'
                },
                body: JSON.stringify(json)
            });

          if (response.status === 401){
          Toastify({
          text: 'Please sign in to add a review.',
          duration: 3000,
          close: true,
          gravity: "top",
          position: "center",
          backgroundColor: "#FF0000",
        }).showToast();
        return;
        }

        const data = await response.json();
        Toastify({
            text: data.message,
            duration: 3000,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor: data.success? "#4CAF50":"FF0000",
        }).showToast();

        if(data.success){
            setTimeout(()=>{
                window.location.href=`lawyersprofile?lawyerId=${lawyerId}`;
            },1000);
        }
        } catch(error){
            console.error('Error:', error);
            Toastify({
            text: "An error occurred. Please try again.",
            duration: 3000, 
            close: true, 
            gravity: "top", 
            position: "center", 
            backgroundColor: "#FF0000", 
          }).showToast();
        }
    })
    const form2 = document.getElementById('review-del');
    const reviewId = document.getElementById('reviewId').value;
    
    form2.addEventListener('submit',async(event)=>{
        event.preventDefault();
        const formData = new FormData(form);
        try{
            const response = await fetch(`/lawyersprofile/reviews/${reviewId}?_method=DELETE`,{
                method: 'POST',
                body:  formData
            });
        const data = await response.json();
        Toastify({
            text: data.message,
            duration: 3000,
            close: true,
            gravity: "top",
            position: "center",
            backgroundColor: data.success? "#4CAF50":"FF0000",
        }).showToast();

        if(data.success){
            setTimeout(()=>{
                window.location.href=`/lawyersprofile?lawyerId=${lawyerId}`;
            },1000);
        }
        } catch(error){
            console.error('Error:', error);
            Toastify({
            text: "An error occurred. Please try again.",
            duration: 3000, 
            close: true, 
            gravity: "top", 
            position: "center", 
            backgroundColor: "#FF0000", 
          }).showToast();
        }
    })
})
  



   const showmenu=(toggleId, navId) =>{
    const toggle = document.getElementById(toggleId),
          nav=document.getElementById(navId);

          toggle.addEventListener('click',()=>{
               nav.classList.toggle('show-menu');
               toggle.classList.toggle('show-icon');

          })

}
showmenu('nav-toggle','nav-menu');

const dropdownItems = document.querySelectorAll('.dropdown-item')

dropdownItems.forEach((item)=>{
    const dropdownButton= item.querySelector('.dropdown-button');
    
    dropdownButton.addEventListener('click',()=>{
         const showDropdown= document.querySelector('.show-dropdown')

         toggleItem(item);

         if(showDropdown && showDropdown!==item){
           toggleItem(showDropdown)
         }
    })
})

const toggleItem = (item) =>{
     const dropdownContainer = item.querySelector('.dropdown-container');
     
     if(item.classList.contains('show-dropdown')){
          dropdownContainer.removeAttribute('style');
          item.classList.remove('show-dropdown');
     }
     else{
         
     dropdownContainer.style.height=dropdownContainer.scrollHeight +'px';
     item.classList.add('show-dropdown'); 
     }


    
}
const mediaQuery=matchMedia('(min-width:1118px)'),
 dropdownContainer=document.querySelectorAll('.dropdown-container')

 const removeStyle=()=>{
     if(mediaQuery.matches){
          dropdownContainer.forEach((e)=>{
             e.removeAttribute('style');
          })

          dropdownContainer.forEach((e)=>{
               e.classList.remove('show-dropdown');
            })
          
     }
 }
 addEventListener('resize',removeStyle);

 const formContainer0=document.querySelector(".form-container-0");
 const contact=document.querySelector(".contact-btn");
 const close=document.querySelector(".close");

 contact.onclick=()=>{
  formContainer0.classList.add('form-active');
 }
 function closeToast() {
  document.getElementById("toast").classList.add("hidden");
}
 close.onclick=()=>{
  formContainer0.classList.remove('form-active');
 }

 /*const replyBtn1=document.querySelector(".reply-btn-span");
 const replyPara1=document.querySelector(".lawyer-reply-para");
 const previousReply1=document.querySelector(".lawyer-previous-reply");
 const showReply1=document.querySelector(".show-reply");
 const hideReply1=document.querySelector(".hide-reply");
 const cncBtn1=document.querySelector(".cnc-btn");

 replyBtn1.onclick=()=>{
    replyPara1.classList.add('para-active');
 }
 cncBtn1.onclick=()=>{
     replyPara1.classList.remove('para-active');
 }
 showReply1.onclick=()=>{
  previousReply1.classList.add("para-active");
 }
 hideReply1.onclick=()=>{
  previousReply1.classList.remove("para-active");
 } */  

 const reviewContainers = document.querySelectorAll(".reveiew-container");

reviewContainers.forEach(container => {
  const replyBtn = container.querySelector(".reply-btn-span");
  const replyPara = container.querySelector(".lawyer-reply-para");
  const previousReply = container.querySelector(".lawyer-previous-reply");
  const showReply = container.querySelector(".show-reply");
  const hideReply = container.querySelector(".hide-reply");
  const cncBtn = container.querySelector(".cnc-btn");

  replyBtn.onclick = () => {
    replyPara.classList.toggle('para-active');
  };

  cncBtn.onclick = () => {
    replyPara.classList.remove('para-active');
  };

  showReply.onclick = () => {
    previousReply.classList.toggle("para-active");
  };

  hideReply.onclick = () => {
    previousReply.classList.remove("para-active");
  };
});


 //const reviewSection = document.querySelector(".reveiew-section");

//reviewSection.addEventListener("click", function(event) {
  // Check if clicked element has class "reply-btn-span"
 /* if (event.target.classList.contains("reply-btn-span")) {
    const replyPara = event.target.closest(".lawyer-reply-para");
    replyPara.classList.toggle("para-active"); // Toggle active class
  }
  // Check if clicked element has class "show-reply"
  if (event.target.classList.contains("show-reply")) {
    const previousReply = event.target.closest(".lawyer-previous-reply");
    previousReply.classList.add("para-active");
  }
  // Check if clicked element has class "hide-reply"
  if (event.target.classList.contains("hide-reply")) {
    const previousReply = event.target.closest(".lawyer-previous-reply");
    previousReply.classList.remove("para-active");
  }
  // Check if clicked element has class "cnc-btn"
  if (event.target.classList.contains("cnc-btn")) {
    const replyPara = event.target.closest(".lawyer-reply-para");
    replyPara.classList.remove("para-active");
  }
});*/


 /*const allstar=document.querySelectorAll(".star");
 const ratingValue=document.querySelector(".reveiew-rating input");

 allstar.forEach((item, idx)=>{
    item.addEventListener('click', function(){
     let click=0;
     ratingValue.value = idx + 1;
     console.log(ratingValue.value);
     allstar.forEach(i=>{
         i.classList.remove('star-checked');
         i.classList.remove('active');
     })
     for (let i=0; i<allstar.length; i++){
          if(i<=idx){
               allstar[i].classList.add('star-checked');
               allstar[i].classList.add('active');
          }
          else{
               allstar[i].style.setProperty('--i',click);
               click++
          }
        }
    })
 })*/
 $(document).ready(function() {
      $('input.star-input').change(function() {
        var rating = $(this).val();
        $('.stars label i').each(function(index) {
          if (index < rating) {
            $(this).removeClass('far').addClass('fas');
          } else {
            $(this).removeClass('fas').addClass('far');
          }
        });
      });


 

     /* $('.reply-btn-span').click(function() {
        var index = $(this).data('index');
        $('#reply-form-' + index).toggleClass('hidden');
      });

      $('.cancel-reply-btn').click(function() {
        var index = $(this).data('index');
        $('#reply-form-' + index).addClass('hidden');
      });

      $('.toggle-replies-btn').click(function() {
        var index = $(this).data('index');
        $('#replies-' + index).toggleClass('hidden');
        $(this).text($(this).text() == 'Show replies' ? 'Hide replies' : 'Show replies');
      });*/
 });
</script>
       
</body>
</html>
